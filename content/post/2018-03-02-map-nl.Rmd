---
title: 荷兰地图
author: 铲屎官
date: '2018-03-02'
slug: map-nl
categories:
  - 铲屎官
---
周末打算学习一下leaflet和shiny。晚上趁着麻子和同事去喝酒不在家的机会，练习了一下画简单的地图。

代码是参考了dataPleth的[这篇文章](http://datapleth.io/2015/10/17/china-base-map/)。感谢。

## 用到的包
```{r eval = FALSE}
library(sp)
library(ggplot2)
library(maptools)
library(broom)
library(data.table)
library(dplyr)
```

### 准备数据
首先从[Global Administrative Areas](http://www.gadm.org/country)上下载荷兰的地理数据。
```{r eval = FALSE}
# read data
map.nl <- readRDS("NLD_adm2.rds")    

# convert rds file to data frame
map.df <- tidy(map.nl)     
str(map.df)

# data
map.data <- map.nl@data
setnames(map.data, "ID_2", "id")

# merge datasets
map.all <- merge(map.df, map.data, by= "id")

# calculate the center of each place
map.sm <- map.all %>% group_by(ID_1) %>%
          summarise(clat = mean(lat), clong = mean(long)) 

# combine datasets
map.data <- left_join(map.data, map.sm)

```

### 准备画图
```{r eval = FALSE}
# ggplot
g <- ggplot(map.all , aes(x = long, y = lat, fill = NAME_1,  group = group) )
g <- g + geom_polygon(aes(x = long + 0.05, y = lat - 0.05), color = "grey50", size = 0.2, fill = "grey50")
g <- g + geom_polygon(color = "white", size = 0.2)
g <- g + coord_equal()
g <- g + theme_bw() + theme(legend.position="none") 
g <- g + geom_text(data = map.data, aes(x = clong, y = clat, label = NAME_1,  group = NULL), check_overlap = TRUE,size= 6) 
g <- g + scale_fill_brewer(palette="Set3", name="Type")

g

ggsave("map.tiff", plot=g, width = 10, height = 10, unit = "in", dpi = 300)
```

### 嗒哒，地图画好啦。
![map-nl](/img/180302.tiff)