---
title: 荷兰地图
author: 铲屎官
date: '2018-03-02'
slug: map-nl
categories:
  - 铲屎官
---



<p>周末打算学习一下<a href="https://rstudio.github.io/leaflet/">leaflet</a>和<a href="https://shiny.rstudio.com/">shiny</a>。晚上趁着麻子和同事出去喝酒了的机会，练习了一下画简单的地图。</p>
<p>代码是参考了dataPleth的<a href="http://datapleth.io/2015/10/17/china-base-map/">这篇文章</a>。感谢。</p>
<div class="section level2">
<h2>用到的包</h2>
<pre class="r"><code>library(sp)
library(ggplot2)
library(maptools)
library(broom)
library(data.table)
library(dplyr)</code></pre>
<div class="section level3">
<h3>准备数据</h3>
<p>首先从<a href="http://www.gadm.org/country">Global Administrative Areas</a>上下载荷兰的地理数据。</p>
<pre class="r"><code># read data
map.nl &lt;- readRDS(&quot;NLD_adm2.rds&quot;)    

# convert rds file to data frame
map.df &lt;- tidy(map.nl)     
str(map.df)

# data
map.data &lt;- map.nl@data
setnames(map.data, &quot;ID_2&quot;, &quot;id&quot;)

# merge datasets
map.all &lt;- merge(map.df, map.data, by= &quot;id&quot;)

# calculate the center of each place
map.sm &lt;- map.all %&gt;% group_by(ID_1) %&gt;%
          summarise(clat = mean(lat), clong = mean(long)) 

# combine datasets
map.data &lt;- left_join(map.data, map.sm)</code></pre>
</div>
<div class="section level3">
<h3>准备画图</h3>
<pre class="r"><code># ggplot
g &lt;- ggplot(map.all , aes(x = long, y = lat, fill = NAME_1,  group = group) )
g &lt;- g + geom_polygon(aes(x = long + 0.05, y = lat - 0.05), color = &quot;grey50&quot;, size = 0.2, fill = &quot;grey50&quot;)
g &lt;- g + geom_polygon(color = &quot;white&quot;, size = 0.2)
g &lt;- g + coord_equal()
g &lt;- g + theme_bw() + theme(legend.position=&quot;none&quot;) 
g &lt;- g + geom_text(data = map.data, aes(x = clong, y = clat, label = NAME_1,  group = NULL), check_overlap = TRUE,size= 6) 
g &lt;- g + scale_fill_brewer(palette=&quot;Set3&quot;, name=&quot;Type&quot;)

g

ggsave(&quot;map.tiff&quot;, plot=g, width = 10, height = 10, unit = &quot;in&quot;, dpi = 300)</code></pre>
</div>
<div class="section level3">
<h3>嗒哒，地图画好啦。</h3>
<div class="figure">
<img src="/img/180302.tiff" alt="map-nl" />
<p class="caption">map-nl</p>
</div>
</div>
</div>
